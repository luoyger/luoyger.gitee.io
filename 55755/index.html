<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta name="baidu-site-verification" content="codeva-WuMoP3T5sT"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>十分钟带你入门向量检索技术 | Luoyger's Blog</title><meta name="author" content="Luoyger"><meta name="copyright" content="Luoyger"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 向量检索介绍1.1 概念介绍随着互联网的不断发展，产生了各种各样的海量数据，比如图片、文本、视频和语音等非结构化数据，这些数据可以通过人工智能技术提取出特征向量，然后通过对这些特征向量的计算和检索来实现对非结构化数据的分析和检索，如何对非结构化的向量数据进行高效检索即为向量检索技术的核心问题。">
<meta property="og:type" content="article">
<meta property="og:title" content="十分钟带你入门向量检索技术">
<meta property="og:url" content="https://www.luoyuanguo.com/55755/index.html">
<meta property="og:site_name" content="Luoyger&#39;s Blog">
<meta property="og:description" content="1. 向量检索介绍1.1 概念介绍随着互联网的不断发展，产生了各种各样的海量数据，比如图片、文本、视频和语音等非结构化数据，这些数据可以通过人工智能技术提取出特征向量，然后通过对这些特征向量的计算和检索来实现对非结构化数据的分析和检索，如何对非结构化的向量数据进行高效检索即为向量检索技术的核心问题。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.luoyuanguo.com/assets/images/gzh-qr.png">
<meta property="article:published_time" content="2023-01-21T16:18:44.000Z">
<meta property="article:modified_time" content="2023-04-07T12:05:39.327Z">
<meta property="article:author" content="Luoyger">
<meta property="article:tag" content="向量">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.luoyuanguo.com/assets/images/gzh-qr.png"><link rel="shortcut icon" href="/assets/images/logo.png"><link rel="canonical" href="https://www.luoyuanguo.com/55755/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8a90e1b8495b546a9696b7ebab1201a5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '十分钟带你入门向量检索技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-07 12:05:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Luoyger's Blog" type="application/atom+xml">
</head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/assets/images/gzh-qr.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-link"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('/assets/images/img_8.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Luoyger's Blog"><img class="site-icon" src="/assets/images/logo.png"/><span class="site-name">Luoyger's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-link"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">十分钟带你入门向量检索技术</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-21T16:18:44.000Z" title="发表于 2023-01-21 16:18:44">2023-01-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-07T12:05:39.327Z" title="更新于 2023-04-07 12:05:39">2023-04-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2/">向量检索</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="十分钟带你入门向量检索技术"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/55755/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/55755/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-向量检索介绍"><a href="#1-向量检索介绍" class="headerlink" title="1. 向量检索介绍"></a>1. 向量检索介绍</h1><h2 id="1-1-概念介绍"><a href="#1-1-概念介绍" class="headerlink" title="1.1 概念介绍"></a>1.1 概念介绍</h2><p>随着互联网的不断发展，产生了各种各样的海量数据，比如图片、文本、视频和语音等非结构化数据，这些数据可以通过人工智能技术提取出特征向量，然后通过对这些特征向量的计算和检索来实现对非结构化数据的分析和检索，如何对非结构化的向量数据进行高效检索即为向量检索技术的核心问题。</p>
<span id="more"></span>
<h2 id="1-2-应用场景"><a href="#1-2-应用场景" class="headerlink" title="1.2. 应用场景"></a>1.2. 应用场景</h2><p>向量检索的应用场景非常丰富，比如：</p>
<ul>
<li>推荐系统：广告推荐、猜你喜欢等；</li>
<li>图片识别：以图搜图，通过图片检索图片。具体应用如：车辆检索和商品图片检索等；</li>
<li>自然语言处理：基于语义的文本检索和推荐，通过文本检索近似文本；</li>
<li>声纹匹配，音频检索；</li>
<li>文件去重：通过文件指纹去除重复文件；</li>
<li>新药搜索；</li>
</ul>
<p>举几个简单的例子<br>如APP的开屏广告推荐、淘宝的以图搜图、搜索引擎的联想词推荐，虽然这些场景可以用其它技术实现，但向量检索也是一个可行的方案。</p>
<h1 id="2-距离计算"><a href="#2-距离计算" class="headerlink" title="2. 距离计算"></a>2. 距离计算</h1><p>向量检索的过程是计算向量之间的相似度，最后返回相似度较高的TopK向量返回，而向量相似度计算有多种方式，不同的计算方式也适用于不同的检索场景。<br>对于浮点型向量和二值型向量有着不同的距离计算方式。</p>
<p>浮点型向量计算方式</p>
<ul>
<li>内积（IP）</li>
<li>欧式（L2）</li>
<li>余弦（Cosine）</li>
</ul>
<p>二值型向量计算方式</p>
<ul>
<li>汉明距离 (Hamming)</li>
<li>杰卡德距离 (Jaccard)</li>
<li>谷本距离 (Tanimoto)</li>
</ul>
<p>介绍距离计算之前，简单了解一下向量归一化公式，归一化后，向量模长|X’|等于1。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/71fe8j7zi3.png"></p>
<h2 id="2-1-内积距离"><a href="#2-1-内积距离" class="headerlink" title="2.1 内积距离"></a>2.1 内积距离</h2><p>内积距离计算的是两个向量在方向上的差异，夹角越小越相似，因此内积值越大越相似。<br>两条向量内积距离的计算公式为：<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/pm1mm8nxqn.png"></p>
<p>内积更适合计算向量的方向而不是大小，通常用于推荐场景。<br>内积在几何意义上是计算一条向量在另一条向量上的垂直投影长度。</p>
<h2 id="2-2-欧式距离"><a href="#2-2-欧式距离" class="headerlink" title="2.2 欧式距离"></a>2.2 欧式距离</h2><p>欧氏距离计算的是两点之间最短的直线距离，距离值越小越相似。<br>欧氏距离的计算公式为：<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/qovdfy9gog.png"></p>
<p>其中 a &#x3D; (a1, a2,…, an) 和 b &#x3D; (b1, b2,…, bn) 是 n 维欧氏空间中的两个点。<br>归一化后，欧式距离与余弦相似度呈单调关系。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/7wgimcp7yc.png"></p>
<p>欧氏距离是最常用的距离计算方式之一，应用广泛，适合数据完整，数据量纲统一的场景。<br>欧氏距离能够体现个体数值特征的绝对差异，所以更多的用于需要从维度的数值大小中体现差异的分析，如使用用户行为指标分析用户价值的相似度或差异。</p>
<h2 id="2-3-余弦距离"><a href="#2-3-余弦距离" class="headerlink" title="2.3 余弦距离"></a>2.3 余弦距离</h2><p>余弦距离计算的是两个向量之间的夹角余弦值，夹角越小越相似，因此余弦相似度值越大越相似。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/9credqerwf.png"></p>
<p>假设向量 A和B归一化后的向量分别是 A’和B’ ，则<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/xgx42jotys.png"></p>
<p>归一化后，内积与余弦相似度计算公式等价。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/hhzjowf991.png"></p>
<p>余弦距离和内积距离更多的是从方向上区分差异，而对绝对的数值不敏感，更多的用于使用用户对内容评分来区分兴趣的相似度和差异，同时修正了用户间可能存在的度量标准不统一的问题。</p>
<p>举例：统计两部剧的用户观看行为，用户A的观看向量为(0,1)，用户B为(1,0)；此时二者的余弦距很大，而欧氏距离相对较小；我们分析两个用户对于不同视频的偏好，更关注相对差异，显然应当使用余弦距离或内积距离。</p>
<h2 id="2-4-汉明距离"><a href="#2-4-汉明距离" class="headerlink" title="2.4 汉明距离"></a>2.4 汉明距离</h2><p>汉明距离计算二进制字符串之间的距离。两个等长字符串之间的汉明距离定义为将其中一个变为另外一个所需要作的最小替换次数。</p>
<p>比如，假设有两条字符串 1101 1001 和 1001 1101。比较时，如果字符相同用 0 表示，如果字符不同则用 1 表示。<br>11011001 ⊕ 10011101 &#x3D; 01000100<br>所以以上两条字符串之间的汉明距离为 2。</p>
<h2 id="2-5-杰卡德距离"><a href="#2-5-杰卡德距离" class="headerlink" title="2.5 杰卡德距离"></a>2.5 杰卡德距离</h2><p>杰卡德相似系数计算数据集之间的相似度，计算方式为：数据集交集的个数和并集个数的比值。计算公式可以表示为：<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/b731w8a9ew.png"></p>
<p>杰卡德距离是用来衡量两个数据集差异性的一种指标，被定义为 1 减去杰卡德相似系数。对于二值变量，杰卡德距离等价于谷本系数。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/75pciv2y9n.png"></p>
<p>杰卡德距离适合字符串相似性度量。</p>
<h2 id="2-6-谷本距离"><a href="#2-6-谷本距离" class="headerlink" title="2.6 谷本距离"></a>2.6 谷本距离</h2><p>对于二值变量，谷本距离公式可表示为：<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/gd6gyme79n.png"><br>值域从 0 到正无穷。<br>对于二值变量，谷本系数等价于杰卡德距离：<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/govsab33eh.png"><br>对于二值变量，谷本系数值域为 0 到 +1（+1 的相似度最高）</p>
<h1 id="3-基础算法"><a href="#3-基础算法" class="headerlink" title="3. 基础算法"></a>3. 基础算法</h1><p>了解了向量检索的计算相似度方式，如何加快检索速度是研究的重点。向量检索的本质是近似近邻搜索（ANNS），尽可能减小查询向量的搜索范围，从而提高查询速度，目前业界的近邻搜索算法主要分为基于树、图、量化和哈希四类。本文主要是对这四类算法思想进行简要的介绍。</p>
<h2 id="3-1-基于树"><a href="#3-1-基于树" class="headerlink" title="3.1 基于树"></a>3.1 基于树</h2><p>基于树的结构进行快速检索的主要思想是通过对K维空间进行多次划分，检索时只需对少数特定子空间进行检索即可，加快检索速度，其原理类似二叉树搜索。优点是简单易实现，缺点是不适合高维度向量场景。<br>基于树的搜索算法主要有KD树和Annoy算法，本文主要对KD树进行简要介绍，帮忙大家加深对K维空间划分和检索的理解。</p>
<ul>
<li>KD-树（K-Dimensional Tree）</li>
<li>Annoy（Approximate Nearest Neighbors Oh Yeah）</li>
</ul>
<h3 id="3-1-1-KD树"><a href="#3-1-1-KD树" class="headerlink" title="3.1.1 KD树"></a>3.1.1 KD树</h3><p>KD树是K-dimension tree的缩写，是对数据点在k维空间（如二维(x，y)，三维(x，y，z)，k维(x，y，z..）中划分的一种数据结构，就是把整个空间划分为特定的几个部分，然后在特定空间的部分内进行相关搜索操作。</p>
<p><strong>KD树构造算法</strong></p>
<ol>
<li>选取方差值最大的数据维度为坐标轴，以训练集中的所有数据坐标中的中位数作为切分点，将超矩形区域切割成两个子区域。将该切分点作为根结点，由根结点生出深度为1的左右子结点，左节点对应坐标小于切分点，右结点对应坐标大于切分点。</li>
<li>对深度为i的结点，选择为切分坐标轴，以该结点区域中训练数据坐标的中位数作为切分点，将区域分为两个子区域，且生成深度为i+1的左、右子结点，左节点对应坐标小于切分点，右结点对应坐标大于切分点。重复以上操作，直到两个子区域没有数据时停止。</li>
</ol>
<p>对于数据集{(6,5),(1,3),(-6-5),(-4-10),(-2,-1),(-5,12),(2,13),(17,-12),(8,-22),(15,-13),(10,-6),(7,15),(14,1)}</p>
<p>该数据集的第一个维度的方差值较大，因此选择第一个维度作为切分轴，其维度中位数为6，选择(6,5)作为切分点，如下左图。重复构造方法的步骤2，经过多次切分后得到的切分图如下右图。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/shz26y0xkd.png"> <img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/x3wj3e62gr.png"></p>
<p>每次切分点为树的节点，最终构造的树结构如下，右侧的X和Y分别表示基于第一个维度和第二个维度进行切分。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/dzrqbbeyg9.png"></p>
<p>一般而言，在空间维度(d&lt;&#x3D;30)比较低的时候，KD树是比较高效的, 针对高维数据提出了优化的KD-tree with BBF（Best Bin First）算法。</p>
<p><strong>KD树的检索算法</strong></p>
<p>假设在数据集S中搜索p节点的邻近topK节点。</p>
<ol>
<li>根据目标p的坐标和kd树的结点向下进行搜索，如果树的结点root是以数据集的维度d以来切分的，那么如果p的维度d坐标值小于root，则走左子结点，否则走右子结点。</li>
<li>到达叶子结点时，将其标记为已访问。如果S中不足k个点，则将该结点加入到S中；否则如果S不空且当前结点与p点的距离小于S中最长的距离，则用当前结点替换S中离p最远的点。</li>
<li>如果当前结点不是根节点，执行（a）；否则，结束算法。<br>（a）回退到当前结点的父结点，此时的结点为当前结点（回退之后的结点）。将当前结点标记为已访问，执行（b）和（c）；如果当前结点已经被访过，再次执行（a）。<br>（b）如果此时S中不足k个点，则将当前结点加入到S中；如果S中已有k个点，且当前结点与p点的距离小于S中最长距离，则用当前结点替换S中距离最远的点。<br>（c）计算p点和当前结点切分线的距离。如果该距离大于等于S中距离p最远的距离并且S中已有k个点，执行步骤3；如果该距离小于S中最远的距离或S中没有k个点，从当前结点的另一子节点开始执行步骤1；如果当前结点没有另一子结点，执行步骤3。</li>
</ol>
<p>假设p节点为(-1,-5)，在数据集中的位置如以下左图，检索邻近3个节点，经过上述搜索算法后，得到3个邻近节点（绿色节点），坐标为(-6,-5), (-1,-3), (-2,-1)。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/bk58oraghi.png"> <img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/56ccrdx2xq.png"></p>
<p>在树中遍历的节点为左子树，如下图中的蓝色线条标识节点，在根节点处结束算法。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/lq7c9abmva.png"></p>
<h3 id="3-1-2-Annoy"><a href="#3-1-2-Annoy" class="headerlink" title="3.1.2 Annoy"></a>3.1.2 Annoy</h3><p>Annoy（Approximate Nearest Neighbors Oh Yeah）是一种用超平面把高维空间分割成多个子空间，并把这些子空间以树型结构存储的索引方式。</p>
<p>在查询时，Annoy 会顺着树结构找到距离目标向量较近的一些子空间，然后比较这些子空间里的所有向量以获得最终结果。显然，当目标向量靠近某个子空间的边缘时，有时需要大大增加搜索的子空间数以获得高召回率。因此，Annoy 会使用 N 次不同的方法来划分全空间，并同时搜索所有划分方法以减少目标向量总是处于子空间边缘的概率。</p>
<p>Annoy 能够使用静态文件作为索引，意味着可以跨进程共享索引。它还创建了大量的基于只读文件的数据结构，这些数据结构被嵌入内存中，以便许多进程可以共享相同的数据。Annoy 的另一个好处是它试图最小化内存占用，因此索引非常小。</p>
<p>具体算法参考：Nearest neighbors and vector models – part 2 – algorithms and data structures</p>
<h2 id="3-2-基于图"><a href="#3-2-基于图" class="headerlink" title="3.2 基于图"></a>3.2 基于图</h2><p>基于图的结构进行快速检索的主要思想是通过对图中邻居节点连线（高速公路）快速缩小搜索范围，加快检索速度，其原理类似Redis跳表。优点是查询速度快，缺点是构建索引耗时长，内存占用大。<br>基于图的搜索算法主要有NSW和HNSW算法，本文主要对HNSW图进行简要介绍，帮忙大家加深对图的构造和检索的理解。</p>
<ul>
<li>NSW（Navigating Small World）</li>
<li>HNSW（Hierarchical Navigating Small World）</li>
</ul>
<h3 id="3-2-1-NSW"><a href="#3-2-1-NSW" class="headerlink" title="3.2.1 NSW"></a>3.2.1 NSW</h3><p><strong>朴素的图搜索算法</strong></p>
<p>如果要找到粉红色的点最近的点，我们从任一个点开始，比如A，从A的相邻的点中(B,C,D)找到离目标最近的点D，接下来从D相邻的点(F,J,E)中找到离目标最近的点E，而在E的相邻的点中(B,D,G,J)中，E是离目标最近，那搜索停止，E就是我们要找的点。<br>但是K点无法查询，E和L邻近点之间没有连线，邻居节点个数无法确定。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/3vcojy5n4v.png"></p>
<p>NSW（Navigable Small World）是一种基于图的基础搜索算法，基于朴素的图搜索算法，保证了所有的点都有相邻的点，相邻 的点有连线，邻近点的个数可以指定。</p>
<p><strong>NSW构图算法</strong></p>
<p>向图中逐个插入点，插图一个全新点时，查找到与这个全新点最近的m个点（m由用户设置），连接全新点到m个点的连线。那么越先被插入的点，越有可能有高速公路，因为插入某一个点时，链接与它相近的点。但是在后面的构图过程中可能会有更近的点插入，那么这些原先的连线就成了高速公路。</p>
<p><strong>NSW搜索机制</strong></p>
<p>在base node的近邻中找到与query最近的点，然后把这个点更新为新的base node，再重复以上过程，直到找到query。<br>NSW论文中配了如下这样一张图，黑色是近邻点的连线，红色线就是“高速公路机制”了。我们从enter point点进入查找，查找绿色点临近节点的时候，就可以用过红色连线“高速公路机制”快速查找到结果。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/hncry2mf65.png"></p>
<h3 id="3-2-2-HNSW"><a href="#3-2-2-HNSW" class="headerlink" title="3.2.2 HNSW"></a>3.2.2 HNSW</h3><p>HNSW（Hierarchical Navigating Small World）是一种基于图的索引算法，也是对NSW方法的改进，它由多层的邻近图组成，因此称为分层的NSW方法。它会为一张图按规则建成多层导航图，并让越上层的图越稀疏，结点间的距离越远；越下层的图越稠密，结点间的距离越近。</p>
<p><strong>构图算法</strong></p>
<p>HNSW将空间中的向量按下图的形式组织，每一个节点插入时，首先将数据保存在第0层。然后随机一个层数，从该层开始逐层往下遍历，每层都将该节点以节点内部id代表插入，并按NSW的构图规则连接M个近邻节点，直至第0层，高层到低层之间的连线即为高速公路。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/cgzdta4g6p.png"></p>
<p><strong>搜索算法</strong></p>
<p>搜索时从最上层开始，找到本层距离目标最近的结点后作为下一层的入口，进入下一层再查找。如此迭代，快速逼近目标位置。<br>0层以上，从enterpoint开始，寻找离目标最近的点。<br>0层，寻找最近的k个点。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/4rxnkxf6e2.png"></p>
<p>HNSW采用类似跳表的思想，在高层跳过大量离目标点较远的点，从而快速定位到离目标较近的点，从而缩小搜索范围。在构图时采用启发式搜索选择连接邻居节点，从而防止出现不连通图的情况。搜索过程中维护动态list，从而减少遗漏的情况。<br>基于图的向量检索算法在向量检索的评测中性能都是比较优异的。如果比较在乎检索算法的效率，而且可以容忍一定的空间成本，多数场景下比较推荐基于图的检索算法。而HNSW是一种典型的，应用广泛的图算法，很多分布式检索引擎都对HNSW算法进行了分布式改造，以应用于高并发，大数据量的线上查询。</p>
<p>但是HNSW的缺点就是，除了保存数据之外，还需要一定的内存维护图的关系，而且每个节点分配固定的内存，其中有些没有使用而造成一定的浪费。</p>
<p>为了提高性能，HNSW 限定了每层图上结点的最大度数 M 。M的合理范围在[2,200]。M越高，对于本身具有高维特征的数据集来讲，recall可能越高，性能越好；M越低，对于本身具有低维特征的数据集来讲，性能越好。</p>
<p>此外，建索引时可以指定 efConstruction，efConstruction 越大，构造时间越长，index quality越好。有时，efConstruction 增加的过快并不能提升index quality。有一种方法可以检查efConstruction 的选择是否可以接受。计算recall，当ef&#x3D;efConstruction ，在M值时，如果recall低于0.9，那么可以适当增加efConstruction 的数值。</p>
<p>查询时可以用 ef 来指定搜索范围，ef值越大，搜索范围越大，搜索时间也越长，一般和efConstruction值搭配调节。</p>
<h2 id="3-3-基于量化"><a href="#3-3-基于量化" class="headerlink" title="3.3 基于量化"></a>3.3 基于量化</h2><p>基于量化的结构进行快速检索的主要思想是将高精度的数值或向量，通过损失一定的精度，用近似的形式进行存储和计算，加快检索速度。优点是减少计算次数，加快检索速度，缺点是有一定的精度损失。<br>基于量化的方法</p>
<ul>
<li>SQ（ ScalarQuantization ）</li>
<li>PQ（ Product Quantization ）</li>
</ul>
<p>SQ是将每一个维度量化成指定位数的一个数，比如将32位的int量化成8位的int，通过损失一定的精度，缩减存储和计算成本，比较简单，本文主要对PQ进行简要介绍，帮忙大家加深对量化的过程和检索的理解。</p>
<p><strong>PQ</strong></p>
<p>乘积量化（PQ）算法是和VLAD算法是由法国INRIA实验室一同提出来的，为的是加快图像的检索速度。</p>
<p><strong>量化算法</strong></p>
<p>PQ先将D维空间切分成M份，现在考虑一个D&#x3D;128维的原始向量，它被切分成了M&#x3D;8个d&#x3D;16维的短向量。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/7bfim2bfi3.png"></p>
<p>同时每个短向量都对应一个量化的索引值，索引值即该短向量距离最近的聚类中心的编号，每一个原始向量就可以压缩成M个索引值构成的压缩向量，只要设计好了数据结构，就可以获得所有1M数据的压缩向量。压缩向量其实就是M个索引值，每个索引值对应一个聚类中心，所以要同时保存压缩向量和聚类中心，下图中的矩阵为压缩后的向量。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/lqjl0pihxd.png"></p>
<p><strong>搜索算法</strong></p>
<p>有2种方法做相似搜索，一种是SDC(symmetric distance computation)，另一种是ADC(asymmetric distance computation)。SDC算法和ADC算法的区别在于是否要对查询向量（x）做量化。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/cjz2gqdvi5.png"></p>
<ul>
<li>对称距离计算：直接使用两个压缩向量x，y的索引值所对应的码字q(x),q(y)之间的距离代替之，而q(x),q(y)之间的距离可以离线计算，因此可以把q(x),q(y)之间的距离制作成查找表，只要按照压缩向量的索引值进行对应的查找就可以了，所以速度非常快；</li>
<li>非对称距离计算：使用x，q(y)之间的距离代替x，y之间的距离，其中x是测试向量。虽然y的个数可能有上百万个，但是q(y)的个数只有k个，对于每个x，我们只需要在输入x之后先计算一遍x和k个q(y)的距离，制成查找表（因为只有k个，所以速度是非常快的），然后按照y对应的压缩向量索引值进行取值操作就可以了。</li>
</ul>
<p>查找过程先将查找向量x进行分段，在每个子段计算x子段到对应256个聚类中心的距离，可以使用对称距离计算或非对称距离计算，计算结果存为256*4码本。然后在每段通过查询码本计算x与每个y的距离（用到所属聚类中心的距离近似计算），然后将每段计算的对应向量的结果累加求和，最后取topK向量。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/a6n0k5wzr6.png"></p>
<p>通过查询码本计算向量的距离，可以大大节省向量计算时间，提高检索速度，聚类的中心越多，检索的精度也越高。<br>PQ算法可以搭配IVF算法（kmeans聚类）组成IVF_PQ算法达到更快的检索速度。</p>
<h2 id="3-4-基于哈希"><a href="#3-4-基于哈希" class="headerlink" title="3.4 基于哈希"></a>3.4 基于哈希</h2><p>基于哈希的结构进行快速检索的主要思想是利用相似度很高的数据以较高的概率映射成同一个hash值，相似度很低的数据以极低的概率映射成同一个hash值，将高维数据降维到低维数据，提高检索效率。优点是能高效处理海量高维数据的最近邻问题，缺点是会有一定的数据失真。<br>基于哈希的方法</p>
<ul>
<li>LSH（Locality-Sensitive Hashing）</li>
</ul>
<p><strong>LSH</strong></p>
<p>LSH是一将原始数据空间中的两个相邻数据点通过相同的映射或投影变换后，这两个数据点在新的数据空间中仍然相邻的概率很大，而不相邻的数据点被映射到同一个桶的概率很小。</p>
<p>LSH定义：将这样的一族hash函数 H&#x3D;{h:S→U} 称为是(r1,r2,p1,p2)敏感的，如果对于任意H中的函数h，满足以下2个条件：</p>
<ul>
<li>如果d(O1,O2)&lt;r1，那么Pr[h(O1)&#x3D;h(O2)]≥p1</li>
<li>如果d(O1,O2)&gt;r2，那么Pr[h(O1)&#x3D;h(O2)]≤p2</li>
</ul>
<p>其中，O1,O2∈S，表示两个具有多维属性的数据对象，d(O1,O2)为2个对象的相异程度，也就是相似度，当足够相似时，映射为同一hash值的概率足够大；而足够不相似时，映射为同一hash值的概率足够小。</p>
<p>如果我们对原始数据进行一些hash映射后，我们希望原先相邻的两个数据能够被hash到相同的桶内，具有相同的桶号。取出该桶号对应桶内的所有数据，再进行线性匹配即可查找到与查询数据相邻的数据。<br><img src="https://image-1306104315.cos.ap-guangzhou.myqcloud.com/blog/2dvcveauo.png"></p>
<p>哈希函数是局部敏感的：相近的样本点对比相远的样本点对更容易发生碰撞。<br>LSH的设计能够通过相应的参数控制出现数据失真的概率，最关键的是构造合适的哈希函数族使得最近邻查找更为精确。</p>
<h1 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h1><p>本文主要对向量检索的概念、应用场景、距离计算方式和基础算法进行了介绍，相信你已经对向量检索技术已经有了初步了解，对于算法部分的介绍，由于篇幅问题没有进行详尽的介绍，推荐自行查询进一步消化理解。后续还将进一步分享向量检索的技术调研、测试、应用和思考。</p>
<h1 id="5-Reference"><a href="#5-Reference" class="headerlink" title="5. Reference"></a>5. Reference</h1><ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://milvus.io/cn/docs/overview.md">https://milvus.io/cn/docs/overview.md</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/nmslib/hnswlib">https://github.com/nmslib/hnswlib</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/zzpzm/article/details/88565645">https://blog.csdn.net/zzpzm/article/details/88565645</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhou-yuxin.github.io/articles/2020/IVFPQ%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/index.html">https://zhou-yuxin.github.io/articles/2020/IVFPQ%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86/index.html</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/guoziqing506/article/details/53019049">https://blog.csdn.net/guoziqing506/article/details/53019049</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.luoyuanguo.com">Luoyger</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.luoyuanguo.com/55755/">https://www.luoyuanguo.com/55755/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.luoyuanguo.com" target="_blank">Luoyger's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%90%91%E9%87%8F/">向量</a></div><div class="post_share"><div class="social-share" data-image="/assets/images/gzh-qr.png" data-sites="wechat,weibo,qq,facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/assets/images/wechatpay-min.png" target="_blank"><img class="post-qr-code-img" src="/assets/images/wechatpay-min.png" alt="微信支付"/></a><div class="post-qr-code-desc">微信支付</div></li><li class="reward-item"><a href="/assets/images/alipay-min.png" target="_blank"><img class="post-qr-code-img" src="/assets/images/alipay-min.png" alt="支付宝支付"/></a><div class="post-qr-code-desc">支付宝支付</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/64241/" title="快速入门Golang Fuzz模糊测试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">快速入门Golang Fuzz模糊测试</div></div></a></div><div class="next-post pull-right"><a href="/49218/" title="Go栈内存管理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Go栈内存管理</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/assets/images/gzh-qr.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Luoyger</div><div class="author-info__description">喜欢折腾技术的开发爱好者。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/luoyger"><i class="fab fa-github"></i><span>微信扫描上面公众号关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/luoyger" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:739052349@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的博客，有任何建议都可以在<a href="messageboard/" style="color:orange">留言板</a>或者<b style="color:green">邮箱</b>留言，当然也可以在网页右下角的<b style="color:blue">在线聊天</b>联系我。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%90%91%E9%87%8F%E6%A3%80%E7%B4%A2%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1. 向量检索介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 概念介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.</span> <span class="toc-text">1.2. 应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E8%B7%9D%E7%A6%BB%E8%AE%A1%E7%AE%97"><span class="toc-number">2.</span> <span class="toc-text">2. 距离计算</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%86%85%E7%A7%AF%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 内积距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%AC%A7%E5%BC%8F%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 欧式距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E4%BD%99%E5%BC%A6%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 余弦距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%B1%89%E6%98%8E%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 汉明距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%9D%B0%E5%8D%A1%E5%BE%B7%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 杰卡德距离</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E8%B0%B7%E6%9C%AC%E8%B7%9D%E7%A6%BB"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 谷本距离</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">3. 基础算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%9F%BA%E4%BA%8E%E6%A0%91"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 基于树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-KD%E6%A0%91"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 KD树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-Annoy"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 Annoy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%9F%BA%E4%BA%8E%E5%9B%BE"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 基于图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-NSW"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 NSW</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-HNSW"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 HNSW</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%9F%BA%E4%BA%8E%E9%87%8F%E5%8C%96"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 基于量化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%9F%BA%E4%BA%8E%E5%93%88%E5%B8%8C"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 基于哈希</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">4. 总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Reference"><span class="toc-number">5.</span> <span class="toc-text">5. Reference</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/45094/" title="Go栈内存不足逃逸分析">Go栈内存不足逃逸分析</a><time datetime="2023-03-01T20:03:49.000Z" title="发表于 2023-03-01 20:03:49">2023-03-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/49218/" title="Go栈内存管理">Go栈内存管理</a><time datetime="2023-02-10T21:08:12.000Z" title="发表于 2023-02-10 21:08:12">2023-02-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/55755/" title="十分钟带你入门向量检索技术">十分钟带你入门向量检索技术</a><time datetime="2023-01-21T16:18:44.000Z" title="发表于 2023-01-21 16:18:44">2023-01-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/64241/" title="快速入门Golang Fuzz模糊测试">快速入门Golang Fuzz模糊测试</a><time datetime="2023-01-01T20:20:19.000Z" title="发表于 2023-01-01 20:20:19">2023-01-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/assets/images/img_2.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Luoyger</div><!--if theme.footer.copyright--><!--  .framework-info--><!--    span= _p('footer.framework') + ' '--><!--    a(href='https://hexo.io')= 'Hexo'--><!--    span.footer-separator |--><!--    span= _p('footer.theme') + ' '--><!--    a(href='https://github.com/jerryc127/hexo-theme-butterfly')= 'Butterfly'--><div>
<span id="busuanzi_container_site_uv" style="display: inline;">共<span id="busuanzi_value_site_uv">0</span>个访客</span>
<span id="busuanzi_container_site_pv" style="display: inline;"> | <span id="busuanzi_value_site_pv">0</span>次访问</span>
</div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/"><img class="icp-icon" src="/assets/images/icp.png" style="width:22px;"><span>粤ICP备2022072681号-2</span></a></div><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/zh-cn/" alt="博客框架为Hexo_v5.3.0"><img src="https://img.shields.io/badge/Frame-Hexo-orange?style=flat&logo=hexo"></img></a>
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender"></img></a>
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/luoyger/luoyger"><img src="https://img.shields.io/badge/Source-Github-blue?style=flat&logo=github"></img></a>
<a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris"></img></a></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'usylbOffOujz6JDbYzj2qErY-gzGzoHsz',
      appKey: '2zAWmFC12iSNaNbTA0holTS2',
      avatar: 'monsterid',
      serverURLs: 'https://usylboff.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, {"placeholder":"欢迎多多留言讨论。"}))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://www.luoyuanguo.com/55755/'
    this.page.identifier = '/55755/'
    this.page.title = '十分钟带你入门向量检索技术'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://luoyger.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "d5a481e6-df57-43b6-bc46-c10a47b9b9d1";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (true) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></body></html>